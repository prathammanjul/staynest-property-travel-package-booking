<% layout("layouts/boilerplate") %>
<link href="/css/stayDetails.css" rel="stylesheet" />
<script>
  const mapToken = "<%= process.env.MAP_TOKEN %>";
  const coordinates = <%- JSON.stringify(listing.geometry.coordinates) %>;
</script>


<div class="listing-head mb-5">

    <h3 class="mt-5 "><%= listing.title %></h3>


  
  <div class=" show-card">
    <img
      src="<%=listing.image.url  %>"
      class="card-img-top show-img mt-3"
      alt="listing-image"
    />
  </div>




  <div class="main-content">
    <div class="left-side">
      <p>
        <h4 class="show-heading"> Stay in <%= `${listing.location + "," + listing.country}` %> </h4>

        <h5 class="mt-3 mb-4 info-text">
          Nested by: <%= listing.owner.username %>
        </h5>

        <hr>

        <h4 class="show-heading mt-4">About this stay</h4>
        <p class="info-text mt-3 stay"><%= listing.description %></p>
      </p>


    
    <!-- edit & delete INSIDE left-side -->
    <% if (currUser && currUser._id.equals(listing.owner._id)) { %>
      <div class="btns  mb-5 mt-4 ">
        <a
          href="/listings/<%= listing._id %>/edit"
          class="btn btn-login me-5 border"
        >
          Edit this listing
        </a>

        <form method="post" action="/listings/<%= listing.id %>?_method=Delete">
          <button class="btn btn-login border">Delete this listing</button>
        </form>
      </div>
      <% } %>


  </div>



<!-- Right Sidebar -->
    <aside class="right-sidebar">
      <!-- Booking Card -->
      <div class="booking-card">
        <h3>Book Your Nest</h3>
        <div class="price-section">
          <div class="price-value">&#8377; <%= listing.price ? listing.price.toLocaleString("en-IN") :
            "0" %>/ night</div>
        </div>
        <button class="book-now-btn btn-signup mb-4">
          Book Now
        </button>
        <button
          class="wishlist-btn contact-expert-btn"
        >
          Add to Wishlist
        </button>
      </div>
    </aside>
  </div>
  </div>
  
  
  <!-- REVIEW SECTION  -->
  <div class="review-content show-heading">
    <!-- <hr /> -->
    <% if (currUser && !listing.owner.equals(currUser._id)) { %>
      <hr>
      <h4 class="mb-4 mt-4">Leave a Reviews</h4>

  <form
    novalidate
    class="mb-5 needs-validation"
    action="/listings/<%= listing.id %>/reviews"
    method="POST"
  >
  
      <div class="mt-3">
        <label for="rating" class="form-label"> Rating</label>
    <fieldset class="starability-grow  ">
  <input type="radio" id="no-rate" class="input-no-rate " name="review[rating]"value="1" checked aria-label="No rating." />
  <input type="radio" id="first-rate1" name="review[rating]" value="1" />
  <label for="first-rate1" title="Terrible">1 star</label>
  <input type="radio" id="first-rate2" name="review[rating]" value="2" />
  <label for="first-rate2" title="Not good">2 stars</label>
  <input type="radio" id="first-rate3" name="review[rating]" value="3" />
  <label for="first-rate3" title="Average">3 stars</label>
  <input type="radio" id="first-rate4" name="review[rating]" value="4" />
  <label for="first-rate4" title="Very good">4 stars</label>
  <input type="radio" id="first-rate5" name="review[rating]" value="5" />
  <label for="first-rate5" title="Amazing">5 stars</label>
</fieldset>
 </div>

    <div class="mb-3">
      <label for="comment" class="form-label"> Comments</label>
      <textarea
        name="review[comment]"
        id="comment"
        cols="30"
        rows="5"
        class="form-control"
        required
      ></textarea>

      <!-- //bootstrap classes for success failure text -->
      <div class="valid-feedback">Looks Good!</div>
      <div class="invalid-feedback">Please write the review!</div>
    </div>

    <button class="btn btn-login mt-3">Submit</button>
  </form>


  <% } %>

  <% if(listing.reviews.length > 0){ %>
    <hr>
  <h4 class="show-heading">All Reviews</h4>
  <div class="reviewContainer mb-5">
  <% for (let reviews of listing.reviews) { %>
  <div class="border p-4 mt-4 mb-2  reviewBox">
    <h5 class="info-text">@<%=reviews.author.username %></h5>
    <p class="starability-result staticCardStar " data-rating= <%=reviews.rating %>>
  </p> 
    <p class="comment info-text">
      <%= reviews.comment %>
    </p>

    <!-- Review Delete button  -->

    <form
      action="/listings/<%= listing._id %>/reviews/<%= reviews._id %>?_method=DELETE"
      method="POST"
      class="mb-1"
    >
      <% if (currUser && !listing.owner.equals(currUser._id)) { %>
      <button class="btn btn-sm btn-login ">Delete</button>
        <% } %>
    </form>
  </div>
  <% } %>
</div>

<% } %>
<hr>
<!-- For Map  -->
<div class= "mt-5">

  <h3>Where youâ€™ll be</h3>
  <p class="mt-3 mb-4"><%= listing.location %>,<%= listing.country %></p>
  <div id="map"></div>
</div>
</div>
</div>


<!-- We will be using Map script file in last  -->
 <script src="/js/map.js">
 </script>







